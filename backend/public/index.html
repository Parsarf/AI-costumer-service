<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Support Bot - Admin</title>
    
    <!-- React -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Simple CSS for styling -->
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f6f6f7;
        }
        .card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 16px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .button {
            background: #4F46E5;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .button:hover {
            background: #4338CA;
        }
        .button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        .input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            font-size: 14px;
            margin-top: 4px;
            box-sizing: border-box;
        }
        .textarea {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            font-size: 14px;
            margin-top: 4px;
            resize: vertical;
            box-sizing: border-box;
        }
        .label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: #374151;
            margin-bottom: 4px;
        }
        .help-text {
            font-size: 12px;
            color: #6b7280;
            margin-top: 4px;
        }
        .success {
            background: #f0fdf4;
            border: 1px solid #bbf7d0;
            color: #166534;
            padding: 12px 16px;
            border-radius: 4px;
            margin-bottom: 16px;
        }
        .error {
            background: #fef2f2;
            border: 1px solid #fecaca;
            color: #dc2626;
            padding: 12px 16px;
            border-radius: 4px;
            margin-bottom: 16px;
        }
        .loading {
            text-align: center;
            padding: 40px;
            font-size: 18px;
            color: #666;
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="loading">Loading AI Support Bot...</div>
    </div>

    <script>
        const React = window.React;
        const ReactDOM = window.ReactDOM;

        // Get URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const shop = urlParams.get('shop');
        const host = urlParams.get('host') || 'admin.shopify.com';

        if (!shop) {
            document.getElementById('app').innerHTML = '<div class="error">Error: Missing shop parameter</div>';
        } else {
            // Simple App Component
            function App() {
                const [loading, setLoading] = React.useState(true);
                const [settings, setSettings] = React.useState({
                    welcomeMessage: 'Hi! How can I help you today?',
                    returnPolicy: 'Please contact support for return information.',
                    shippingPolicy: 'Please contact support for shipping information.',
                    supportEmail: 'support@store.com',
                    botPersonality: 'friendly',
                    primaryColor: '#4F46E5'
                });
                const [saving, setSaving] = React.useState(false);

                React.useEffect(() => {
                    loadData();
                }, []);

                async function loadData() {
                    try {
                        setLoading(true);
                        
                        // Load settings
                        const response = await fetch(`/api/settings?shop=${shop}`);
                        if (response.ok) {
                            const data = await response.json();
                            if (data.settings) {
                                setSettings(data.settings);
                            }
                        }
                    } catch (err) {
                        console.error('Error loading data:', err);
                    } finally {
                        setLoading(false);
                    }
                }

                async function saveSettings() {
                    try {
                        setSaving(true);
                        
                        const response = await fetch(`/api/settings?shop=${shop}`, {
                            method: 'PUT',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ settings })
                        });

                        if (response.ok) {
                            alert('Settings saved successfully!');
                        } else {
                            throw new Error('Failed to save settings');
                        }
                    } catch (err) {
                        console.error('Error saving settings:', err);
                        alert('Failed to save settings');
                    } finally {
                        setSaving(false);
                    }
                }

                if (loading) {
                    return React.createElement('div', { className: 'loading' },
                        React.createElement('div', { style: { fontSize: '18px', color: '#666' } }, 'Loading AI Support Bot...')
                    );
                }

                return React.createElement('div', { style: { maxWidth: '800px', margin: '0 auto', padding: '20px' } },
                    React.createElement('h1', { style: { fontSize: '28px', fontWeight: '600', margin: '0 0 8px 0', color: '#111827' } }, 'AI Support Bot'),
                    React.createElement('p', { style: { fontSize: '16px', color: '#6b7280', margin: '0 0 24px 0' } }, 'Configure your AI-powered customer support'),

                    // Settings Card
                    React.createElement('div', { className: 'card' },
                        React.createElement('h2', { style: { fontSize: '18px', fontWeight: '600', margin: '0 0 16px 0', color: '#374151' } }, 'Bot Settings'),
                        
                        React.createElement('div', { style: { marginBottom: '16px' } },
                            React.createElement('label', { className: 'label' }, 'Welcome Message'),
                            React.createElement('textarea', {
                                className: 'textarea',
                                value: settings.welcomeMessage,
                                onChange: (e) => setSettings({...settings, welcomeMessage: e.target.value}),
                                rows: 2
                            }),
                            React.createElement('div', { className: 'help-text' }, 'The first message customers see when they open the chat')
                        ),

                        React.createElement('div', { style: { marginBottom: '16px' } },
                            React.createElement('label', { className: 'label' }, 'Return Policy'),
                            React.createElement('textarea', {
                                className: 'textarea',
                                value: settings.returnPolicy,
                                onChange: (e) => setSettings({...settings, returnPolicy: e.target.value}),
                                rows: 3
                            }),
                            React.createElement('div', { className: 'help-text' }, 'Your store\'s return policy information')
                        ),

                        React.createElement('div', { style: { marginBottom: '16px' } },
                            React.createElement('label', { className: 'label' }, 'Shipping Policy'),
                            React.createElement('textarea', {
                                className: 'textarea',
                                value: settings.shippingPolicy,
                                onChange: (e) => setSettings({...settings, shippingPolicy: e.target.value}),
                                rows: 3
                            }),
                            React.createElement('div', { className: 'help-text' }, 'Your store\'s shipping policy information')
                        ),

                        React.createElement('div', { style: { marginBottom: '16px' } },
                            React.createElement('label', { className: 'label' }, 'Support Email'),
                            React.createElement('input', {
                                className: 'input',
                                type: 'email',
                                value: settings.supportEmail,
                                onChange: (e) => setSettings({...settings, supportEmail: e.target.value})
                            }),
                            React.createElement('div', { className: 'help-text' }, 'Email address for customer support')
                        ),

                        React.createElement('div', { style: { marginBottom: '16px' } },
                            React.createElement('label', { className: 'label' }, 'Bot Personality'),
                            React.createElement('select', {
                                className: 'input',
                                value: settings.botPersonality,
                                onChange: (e) => setSettings({...settings, botPersonality: e.target.value})
                            },
                                React.createElement('option', { value: 'friendly' }, 'Friendly'),
                                React.createElement('option', { value: 'professional' }, 'Professional'),
                                React.createElement('option', { value: 'efficient' }, 'Efficient')
                            )
                        ),

                        React.createElement('div', { style: { marginBottom: '16px' } },
                            React.createElement('label', { className: 'label' }, 'Widget Color'),
                            React.createElement('input', {
                                className: 'input',
                                type: 'color',
                                value: settings.primaryColor,
                                onChange: (e) => setSettings({...settings, primaryColor: e.target.value})
                            }),
                            React.createElement('div', { className: 'help-text' }, 'Primary color for the chat widget')
                        ),

                        React.createElement('button', {
                            className: 'button',
                            disabled: saving,
                            onClick: saveSettings
                        }, saving ? 'Saving...' : 'Save Settings')
                    ),

                    // Status Card
                    React.createElement('div', { className: 'card' },
                        React.createElement('h2', { style: { fontSize: '18px', fontWeight: '600', margin: '0 0 16px 0', color: '#374151' } }, 'App Status'),
                        React.createElement('div', { className: 'success' },
                            React.createElement('strong', {}, '✅ App is running successfully!'),
                            React.createElement('br'),
                            'Your AI support bot is ready to help customers on your store.'
                        )
                    ),

                    // Instructions Card
                    React.createElement('div', { className: 'card' },
                        React.createElement('h2', { style: { fontSize: '18px', fontWeight: '600', margin: '0 0 16px 0', color: '#374151' } }, 'Setup Instructions'),
                        React.createElement('ol', { style: { paddingLeft: '20px', lineHeight: '1.6' } },
                            React.createElement('li', { style: { marginBottom: '8px' } }, 'Go to Online Store → Themes'),
                            React.createElement('li', { style: { marginBottom: '8px' } }, 'Click Customize on your active theme'),
                            React.createElement('li', { style: { marginBottom: '8px' } }, 'Go to App embeds section'),
                            React.createElement('li', { style: { marginBottom: '8px' } }, 'Enable "AI Assistant Widget"'),
                            React.createElement('li', { style: { marginBottom: '8px' } }, 'Configure widget settings and save')
                        )
                    )
                );
            }

            // Render the app
            ReactDOM.render(React.createElement(App), document.getElementById('app'));
        }
    </script>
</body>
</html>