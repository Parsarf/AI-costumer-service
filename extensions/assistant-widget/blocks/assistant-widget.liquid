{% comment %}
  AI Assistant Widget Block
  This block adds a floating chat widget to the storefront
  Configured via Theme Editor settings
{% endcomment %}

<div id="ai-assistant-root" 
     data-shop="{{ shop.permanent_domain }}"
     data-api-url="{{ app.api_url }}"
     data-welcome-message="{{ block.settings.welcome_message | escape }}"
     data-primary-color="{{ block.settings.primary_color | default: '#4F46E5' }}"
     data-position="{{ block.settings.position | default: 'bottom-right' }}"
     data-show-mobile="{{ block.settings.show_on_mobile | default: true }}"
     data-auto-open="{{ block.settings.auto_open_delay | default: 0 }}"
     style="display: none;">
</div>

{% comment %} Load widget styles {% endcomment %}
{{ 'assistant-widget.css' | asset_url | stylesheet_tag }}

{% comment %} Load widget JavaScript {% endcomment %}
<script>
  (function() {
    // Only load if not already loaded
    if (window.AIAssistantLoaded) return;
    window.AIAssistantLoaded = true;
    
    const script = document.createElement('script');
    script.src = '{{ "assistant-widget.js" | asset_url }}';
    script.defer = true;
    script.async = true;
    script.onload = function() {
      if (window.AIAssistantWidget) {
        window.AIAssistantWidget.init();
      }
    };
    script.onerror = function() {
      console.error('Failed to load AI Assistant Widget');
    };
    document.head.appendChild(script);
  })();
</script>

{% schema %}
{
  "name": "AI Assistant Widget",
  "target": "head",
  "settings": [
    {
      "type": "text",
      "id": "welcome_message",
      "label": "Welcome Message",
      "default": "Hi! How can I help you today?",
      "info": "The first message customers see when they open the chat"
    },
    {
      "type": "color",
      "id": "primary_color",
      "label": "Widget Color",
      "default": "#4F46E5",
      "info": "Choose the primary color for the chat widget"
    },
    {
      "type": "select",
      "id": "position",
      "label": "Widget Position",
      "options": [
        {
          "value": "bottom-right",
          "label": "Bottom Right"
        },
        {
          "value": "bottom-left",
          "label": "Bottom Left"
        }
      ],
      "default": "bottom-right",
      "info": "Choose where to display the chat widget on your store"
    },
    {
      "type": "checkbox",
      "id": "show_on_mobile",
      "label": "Show on Mobile",
      "default": true,
      "info": "Display the chat widget on mobile devices"
    },
    {
      "type": "range",
      "id": "auto_open_delay",
      "label": "Auto-open Delay (seconds)",
      "min": 0,
      "max": 60,
      "step": 5,
      "default": 0,
      "info": "Automatically open chat after this many seconds (0 = disabled)"
    }
  ]
}
{% endschema %}